#!/usr/bin/env bash
# This script displays DNS A record info for subdomains of a domain.

get_subdomain_info() {
  local domain=$1
  local subdomain=$2

  # Run dig to get the A record for the subdomain
  # Extract record type and destination IP using awk
  read -r record_type dest <<< $(dig +noall +answer ${subdomain}.${domain} | awk '/IN\s+A/ {print $4, $5}')

  # If dig outputs nothing, fallback to just get record type and IP
  if [ -z "$record_type" ] || [ -z "$dest" ]; then
    # Just find the record type and IP address
    # This fallback is for robustness; main approach is above.
    dest=$(dig +short ${subdomain}.${domain})
    record_type="A"
  fi

  echo "The subdomain $subdomain is a $record_type record and points to $dest"
}

domain=$1
subdomain=$2

if [ -z "$domain" ]; then
  echo "Usage: $0 <domain> [subdomain]"
  exit 1
fi

if [ -z "$subdomain" ]; then
  for sub in www lb-01 web-01 web-02; do
    get_subdomain_info "$domain" "$sub"
  done
else
  get_subdomain_info "$domain" "$subdomain"
fi
